<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
    <link rel='shortcut icon' type='image/icon' href='favicon.ico' />
    <title>Let's Talk!</title>
    <script src="http://maps.googleapis.com/maps/api/js"></script>

    <script>

    var fireBaseUrl = 'http://boiling-fire-5055.firebaseIO.com/';
    var myDataRef = new Firebase(fireBaseUrl);
//ADD DUMMY DATA YOU DUMMY
//Hey there
    var locations = [
        ['Girls Who Code', 37.5239915, -122.2553, 4],
        ['Kelela', 21.645477, -157.926795, 5],
        ['Cronulla Beach', -34.028249, 151.157507, 3],
        ['Manly Beach', -33.80010128657071, 151.28747820854187, 2],
        ['Maroubra Beach', -33.950198, 151.259302, 1]
    ];
//starter convos, in the future start blank or something like that
    var allconvos = {"Girls Who Code":{"name":"Girls Who Code", "comments":["Best program ever!", "10 out of 10, would do Girls Who Code again!"]},
                   "Kelela":{"name":"Kelela", "comments":["Well hello there :)"]},
                   "Cronulla Beach":{"name": "Cronulla Beach", "comments":[]},
                   "Manly Beach":{"name": "Manly Beach", "comments":[]},
                   "Maroubra Beach":{"name": "Maroubra Beach", "comments":[]},
    };

function initialize() {

    var mapProp = {
        center:new google.maps.LatLng(39.5,-98.35), //Centers the map on this latitude and longitude
        zoom:4, //the amount of zoom
        mapTypeId:google.maps.MapTypeId.ROADMAP //sets up the map
    };
    var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);//make the map a variable and puts it in "googleMap" element, adds the mapProp variable elements to it

    google.maps.event.addListener(map, 'click', function(event) {
        $("#latitude").val(event.latLng.lat())
        $("#longitude").val(event.latLng.lng())
        //alert( 'Latitude: ' + event.latLng.lat() + '\r\nLongitude: ' + event.latLng.lng() );
    });

    var styles=[
        {
            "featureType": "water",
            "elementType": "geometry",
            "stylers": [
                {
                    "color": "#37363b"
                }
            ]
        },
        {
            "featureType": "landscape",
            "elementType": "geometry",
            "stylers": [
                {
                    "color": "#2ecc71"
                }
            ]
        },
        {
            "featureType": "poi",
            "stylers": [
                {
                    "color": "#2ecc71"
                },
                {
                    "lightness": -7
                }
            ]
        },
        {
            "featureType": "road.highway",
            "elementType": "geometry",
            "stylers": [
                {
                    "color": "#2ecc71"
                },
                {
                    "lightness": -28
                }
            ]
        },
        {
            "featureType": "road.arterial",
            "elementType": "geometry",
            "stylers": [
                {
                    "color": "#2ecc71"
                },
                {
                    "visibility": "on"
                },
                {
                    "lightness": -15
                }
            ]
        },
        {
            "featureType": "road.local",
            "elementType": "geometry",
            "stylers": [
                {
                    "color": "#2ecc71"
                },
                {
                    "lightness": -18
                }
            ]
        },
        {
            "elementType": "labels.text.fill",
            "stylers": [
                {
                    "color": "#ffffff"
                }
            ]
        },
        {
            "elementType": "labels.text.stroke",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        },
        {
            "featureType": "transit",
            "elementType": "geometry",
            "stylers": [
                {
                    "color": "#2ecc71"
                },
                {
                    "lightness": -34
                }
            ]
        },
        {
            "featureType": "administrative",
            "elementType": "geometry",
            "stylers": [
                {
                    "visibility": "on"
                },
                {
                    "color": "#37363b"
                },
                {
                    "weight": 0.8
                }
            ]
        },
        {
            "featureType": "poi.park",
            "stylers": [
                {
                    "color": "#2ecc71"
                }
            ]
        },
        {
            "featureType": "road",
            "elementType": "geometry.stroke",
            "stylers": [
                {
                    "color": "#37363b"
                },
                {
                    "weight": 0.3
                },
                {
                    "lightness": 10
                }
            ]
        }
    ]

    var infowindow = new google.maps.InfoWindow();

    var marker, i;

    for (i = 0; i < locations.length; i++) {  
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]), map: map
            });

            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function() {
                    infowindow.setContent(locations[i][0]);
                    infowindow.open(map, marker);
                }
            })(marker, i));
        }
        map.setOptions({styles: styles});
        createConversations();
    }
    var addmarker=function(){
        var ulat= $("#latitude").val();
        var ulong= $("#longitude").val();
        var udesc= $("#description").val();
        locations.push([udesc, ulat, ulong]);
        allconvos[udesc]={"name":udesc, "comments":[]};
        initialize();
        $("#latitude").val("");
        $("#longitude").val("");
        $("#description").val("");
        
    }
//clears current convo boxes and adds all of them into the same space again
//the <br> helps to keep the individual convos separated
    var createConversations=function() {
        $("#conversations").html('');
        for (item in allconvos) {
            var currentconvo=allconvos[item];
            var title=currentconvo["name"]; //kind of unnecessary, the two values should be exactly the same
            var titleid=title.replace(/\s+/g, ''); //removes spaces from title bc ids can't have spaces
            var commentareaid=titleid+"comments";//creates a special id specifically for the comment area
            var htmlstring = '<div id =\'' + titleid + '\' class="convobox" onclick="expandconvo(\''+title+'\', \''+commentareaid+'\')"><h1>'+title+'</h1><br></div> <br> <div div id=\'' + commentareaid + '\' class="convobox"></div>' //comment area needs its own id because if you don't, every time you click in the comment area it will call expandconvo and you will never be able to type anything in it
            $("#conversations").append(htmlstring);
        }
    }
google.maps.event.addDomListener(window, 'load', initialize); //loads map when page loads

    var expandconvo=function(convotoexpand, convocommentid){
        var commentslist=allconvos[convotoexpand]["comments"];
        var commentid="#"+convocommentid; //adds # because as we learned before, you can't combine strings and variables when you really need them in the html area
        var specialcommentcontentid="commentcontent"+convocommentid
        $(commentid).html(''); //resets div so that stuff can't be duplicated
        if (commentslist.length>0){ //only adds comments if there are any
            for (index in commentslist){ // adds each comment in list
                $(commentid).append('<p>'+commentslist[index]+'</p> <br>');
            }
        }
        $(commentid).append('<label for="textarea-6" class="ui-hidden-accessible">Textarea:</label>\
                    <textarea cols="40" rows="8" name="commentcontent" id=\'' + specialcommentcontentid + '\' placeholder="Share your opinion on this topic!"></textarea><br>\
                    <input type="button" value="Submit" data-theme="b" data-inline="true" onclick="addcomment(\'' + convotoexpand + '\', \'' + convocommentid + '\')">');
                    //adds comment form and submit button
                    //FIX: not in jquery mobile form
                    //What we learned: id names can't be a string and a variable combined, they can't have spaces
    }

    var addcomment=function(convotoaddto, convocommentid){
        var convocommentidfinal="#commentcontent"+convocommentid; //adds #commentcontent so it will be equal to the "specialcommentcontentid" in the last function and only affect that area
        var ucomment=$(convocommentidfinal).val(); //creates a variable for what is inside of the text area
        if (ucomment!=""){ //only adds comment if the comment box has text in it, AKA not undefined
            allconvos[convotoaddto]["comments"].push(ucomment); //adds comment to that conversation's comment list
            expandconvo(convotoaddto, convocommentid); //calls expand convo again in order to kind of "refresh" the comment area
        }
    }

</script>
</head>

<body>

<style>
    #mappage, #convopage{background-image: url("background.png");}
    h1, p{
        color:#FFFFFF;
        font-family: "Trebuchet MS", Helvetica, sans-serif;
        text-shadow:2px 2px 4px #000000;
    }
    p{
        font-size: 25px
    }
    .convobox{
        background: rgba(255, 255, 255, 0.5);
        text-align: center;
    }
</style>

<div data-role="page" id="mappage">
    <div data-role="header">
        <div data-role="navbar">
            <ul>    
              <li><a href="#mappage">Map of Our Issues</a></li>
              <li><a href="#convopage">Conversations</a></li>
              <!--<li><a href="#anylink">Search</a></li>-->
            </ul>
        </div>
    </div>
    <div id="googleMap" style="width:500px;height:380px;">
    </div>

    <h1>Is there an issue in your community that you want everyone to know about? Voice your opinion!</h1>
    <p>To find a latitude and longitude, just click on a location on the map that you want to mark. The latitude and longitude fields will be filled for you by using magic!</p>

    <div data-role="fieldcontain" class="ui-hide-label">
        <label for="latitude">Latitude:</label>
        <input type="text" name="latitude" id="latitude" value="" placeholder="Latitude"/>
    </div>
    <div data-role="fieldcontain" class="ui-hide-label">
        <label for="longitude">Longitude:</label>
        <input type="text" name="longitude" id="longitude" value="" placeholder="Longitude"/>
    </div>
    <div data-role="fieldcontain" class="ui-hide-label">
        <label for="description">Description:</label>
        <input type="text" name="description" id="description" value="" placeholder="Description"/>
    </div>
    <input type="button" value="Submit" data-theme="b" data-inline="true" onclick="addmarker()">
        </select>

</div>
<div data-role="page" id="convopage">
    <div data-role="header">
        <div data-role="navbar">
            <ul>    
              <li><a href="#mappage">Map of Our Issues</a></li>
              <li><a href="#convopage">Conversations</a></li>
              <!--<li><a href="#anylink">Search</a></li>-->
            </ul>
        </div>
    </div>
    <div data-role="content">
        <div id = "conversations">
        </div>
</div>

<script>
var screenheight=screen.height-200;
var screenwidth=screen.width-100;
console.log(screenwidth)
document.getElementById("googleMap").style.width=screenwidth+"px";
document.getElementById("googleMap").style.height=screenheight+"px";


</script>
</body>



</html>